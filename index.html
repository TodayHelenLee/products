<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ViewUI example</title>

    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/view-design/dist/styles/iview.css"
    />
    <link rel="stylesheet" href="./pro.css" />
    <script src="https://cdn.jsdelivr.net/npm/nanoid/nanoid.js"></script>
    <script
      type="text/javascript"
      src="https://vuejs.org/js/vue.min.js"
    ></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/view-design/dist/iview.min.js"
    ></script>
    <script src="https://unpkg.com/vuex"></script>
    <script src="https://unpkg.com/vue-router@2.0.0/dist/vue-router.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.22.0/axios.min.js"
      integrity="sha512-m2ssMAtdCEYGWXQ8hXVG4Q39uKYtbfaJL5QMTbhl2kc6vYyubrKHhr6aLLXW4ITeXSywQLn1AhsAaqrJl8Acfg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body>
    <div id="app">
      <div class="layout">
        <layout>
          <i-header>
            <i-menu mode="horizontal" theme="dark" active-name="1">
              <div class="layout-nav">
                <menu-item name="1" @click.native="add1(1)">
                  <icon type="ios-navigate"></icon>
                  最新消息
                </menu-item>
                <menu-item name="2" @click.native="add2(2)">
                  <icon type="ios-keypad"></icon>
                  產品型錄
                </menu-item>
                <menu-item name="3" @click.native="add3(3)">
                  <icon type="ios-analytics"></icon>
                  加入會員
                </menu-item>
                <menu-item name="4" @click.native="add4">
                  <icon type="md-card"></icon>
                  結帳
                </menu-item>
              </div>
            </i-menu></i-header
          ><i-content :style="{padding: '0 50px'}">
            <div :class="{fixUp:true,disappear:isAppear}">
              <div @click="dropOut" class="fixUpTitle">{{login}}</div>
              帳號:<input v-model.trim="count" type="text" />姓名:<input
                v-model.trim.number="name"
                type="text"
              />
              <div>
                <input
                  id="fixButton"
                  class="fixButton"
                  type="reset"
                  value="清空"
                  @click="clear"
                /><input
                  @click="send"
                  class="fixButton"
                  type="button"
                  value="送出"
                />
                <icon type="md-add" @click="remove" class="myAdd" />
              </div>
            </div>
            <div v-if="lis[0]">
              <div class="top">最新消息</div>
              <carousel
                class="app"
                autoplay
                autoplay-speed="3000"
                v-model="value2"
                loop
              >
                <carousel-item>
                  <div class="outWrap">
                    <div style="position: relative" class="demo-carousel">
                      <div
                        style="
                          position: absolute;
                          z-index: 2;
                          left: 90px;
                          top: 10px;
                        "
                      >
                        <h3>三本言情小說七折</h3>
                      </div>
                      <img
                        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTeYmxbdOqzu7c_DAvKheseGdYZeTA9HyUu8A&usqp=CAU"
                        alt=""
                      />
                    </div>
                  </div>
                </carousel-item>

                <carousel-item>
                  <div class="outWrap">
                    <div style="position: relative" class="demo-carousel">
                      <div
                        style="
                          position: absolute;
                          z-index: 2;
                          left: 90px;
                          top: 10px;
                        "
                      >
                        <h3>你誆最新科幻著作</h3>
                      </div>
                      <img
                        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQQ0w6AYZ2pwgD96HRRqMhn2MqZ-Q6wI_CrjQ&usqp=CAU"
                        alt=""
                      />
                    </div>
                  </div>
                </carousel-item>
                <carousel-item>
                  <div class="outWrap">
                    <div style="position: relative" class="demo-carousel">
                      <div
                        style="
                          position: absolute;
                          z-index: 2;
                          left: 90px;
                          top: 10px;
                        "
                      >
                        <h3>日本暢銷電影原著</h3>
                      </div>
                      <img
                        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRC59eGLdxYAqJfe-dD8gdCmXrfszaRREHqtw&usqp=CAU"
                        alt=""
                      />
                    </div>
                  </div>
                </carousel-item>
                <carousel-item>
                  <div class="outWrap">
                    <div style="position: relative" class="demo-carousel">
                      <div
                        style="
                          position: absolute;
                          z-index: 2;
                          left: 90px;
                          top: 10px;
                        "
                      >
                        <h3>暢銷漫畫</h3>
                      </div>
                      <img
                        src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQJre3QiASt40aoX2LIoBrXUS0yyYjC5jImhw&usqp=CAU"
                      />
                    </div>
                  </div>
                </carousel-item>
              </carousel>

              <i-table
                style="margin-top: 60px"
                :columns="columns"
                :data="list"
              ></i-table>
              <Page
                :total="total"
                :current="page"
                @on-change="changePage"
              ></Page>
            </div>
            <div v-if="lis[1]">
              <div class="top">
                產品目錄
                <div class="inputs">
                  <i-input
                    v-model="filter"
                    maxlength="200"
                    search
                    enter-button="Search"
                    placeholder="輸入書名..."
                  />
                </div>
              </div>
              <row
                type="flex"
                justify="center"
                style="background: #eee; padding: 20px"
              >
                <div v-for="(item, index) in filter_a" :key="index">
                  <div class="bookWrap">
                    <p style="font-size: 20px">{{item.title}}</p>
                    <p style="color: red">{{item.dollar}}$</p>
                    <div width="70%" class="control">
                      <img width="70%" :src="item.url" alt="" />
                    </div>
                    <i-button type="Primary" @click="addCar(index)">
                      加入購物車
                    </i-button>
                  </div>
                </div>
              </row>
            </div>
            <div v-if="lis[2]">
              <div class="top">加入會員</div>
              <div class="left">
                <h1>Login In</h1>
                <h3>
                  加入會員登入帳號後，始可享有專屬會員線上購物，修改帳號密碼，查詢購物清單。
                </h3>
              </div>
              <i-form
                class="right"
                ref="formValidate"
                :model="formValidate"
                :rules="ruleValidate"
                :label-width="80"
              >
                <form-item label="姓　　名" prop="name">
                  <i-input
                    v-model="formValidate.name"
                    placeholder="Enter your name"
                  ></i-input>
                </form-item>
                <form-item label="帳號email" prop="mail">
                  <i-input
                    v-model="formValidate.mail"
                    placeholder="Enter your e-mail"
                  ></i-input>
                </form-item>
                <form-item label="聯絡地址" prop="city">
                  <i-input
                    v-model="formValidate.city"
                    placeholder="Select your city"
                  >
                  </i-input>
                </form-item>
                <form-item label="出生日期">
                  <row>
                    <i-col span="11">
                      <form-item prop="date">
                        <date-picker
                          type="date"
                          placeholder="Select date"
                          v-model="formValidate.date"
                        ></date-picker>
                      </form-item>
                    </i-col>
                  </row>
                </form-item>
                <form-item label="性　　別" prop="gender">
                  <radio-group v-model="formValidate.gender">
                    <radio label="male">Male</radio>
                    <radio label="female">Female</radio>
                  </radio-group>
                </form-item>
                <form-item label="聯絡電話" prop="phone">
                  <i-input v-model="formValidate.phone"> </i-input>
                </form-item>
                <form-item label="意見" prop="desc">
                  <i-input
                    v-model="formValidate.desc"
                    type="textarea"
                    :autosize="{minRows: 2,maxRows: 5}"
                    placeholder="Enter something..."
                  ></i-input>
                </form-item>
                <form-item>
                  <i-button type="primary" @click="handleSubmit('formValidate')"
                    >輸入</i-button
                  >
                  <i-button
                    @click="handleReset('formValidate')"
                    style="margin-left: 8px"
                    >清除</i-button
                  >
                </form-item>
              </i-form>
            </div>
            <div v-if="lis[3]">
              <div class="top">結帳</div>
              <div class="left">
                <div>購物明細</div>
                <div>
                  <i-button
                    @click.stop.prevent="selectAll"
                    type="primary"
                    style="position: absolute; left: 120px; top: 120px"
                  >
                    全選
                  </i-button>
                  <i-button
                    @click.stop.prevent="deleteAll"
                    type="primary"
                    style="position: absolute; left: 200px; top: 120px"
                  >
                    刪除
                  </i-button>
                </div>
                <ul v-for="(item, index) in carBook" :key="index">
                  <li class="cards">
                    <i-col>
                      <card>
                        <p slot="title" :style="{height:'100px' }">
                          <checkbox
                            v-model="item.checked"
                            :checked="item.checked"
                            style="margin-top: -50px"
                          ></checkbox>

                          <img
                            :style="{height:'100px' }"
                            :src="item.url"
                            alt=""
                            srcset=""
                          />
                        </p>
                        <p>書名:{{item.title}}</p>
                        <hr />
                        <p>單價:{{item.dollar}}</p>
                        <p>
                          數量:{{item.click}}
                          <input
                            v-model="item.click"
                            style="margin-left: 20px; width: 100px"
                            type="number"
                            min="0"
                            name=""
                            id=""
                          />
                        </p>
                        <hr />
                        <p>總額:{{item.dollar*item.click}}</p>
                      </card>
                    </i-col>
                  </li>
                </ul>
                <i-button
                  @click.stop.prevent="deleteAll"
                  type="error"
                  style="position: absolute; left: 280px; top: 120px"
                >
                  結帳
                </i-button>
                <div id="app">
                  <row> </row>
                </div>
              </div>
            </div>
          </i-content>
          <i-footer class="layout-footer-center"
            >2011-2016 &copy; TalkingData</i-footer
          >
        </layout>
      </div>
    </div>
    <script>
      const data = [];
      const name = [
        "光化出版社",
        "奇金文化",
        "奇金文化",
        "長頸兔文教機構",
        "奇金文化",
        "銅周刊",
        "奇金文化",
        "銅周刊",
        "奇金文化",
        "大大文化",
      ];
      for (let i = 0; i < 20; i++) {
        data.push({
          id: i + 1,
          name: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eum maxime hic amet, sint modi assumenda atque necessitatibus nostrum esse blanditiis sed, a officiis harum minima, pariatur vero temporibus voluptatibus obcaecati.",
          member: name[i],
        });
      }

      function getPagelist(p, size) {
        return data.slice((p - 1) * size, p * size);
      }

      const pageSize = 9;

      new Vue({
        el: "#app",
        mounted() {
          //建置布告欄假資料 在畫面掛載後
          for (let i = 0; i < 20; i++) {
            data.push({
              id: i + 1,
              name: "Lorem ipsum dolor sit amet, consectetur adipisicing elit. Eum maxime hic amet, sint modi assumenda atque necessitatibus nostrum esse blanditiis sed, a officiis harum minima, pariatur vero temporibus voluptatibus obcaecati.",
              member: name[i],
            });
          }
          function getPagelist(p, size) {
            return data.slice((p - 1) * size, p * size);
          }

          //掛載書本資料
          const pageSize = 9;
          for (var i = 0; i < 9; i++) {
            this.a.push({
              title: this.title[i],
              url: this.url[i],
              dollar: Math.floor(Math.random() * 500) + 100,
              click: 0,
              checked: false,
            });
          }
        },
        updated() {
          console.log(this.remeber);
        },
        computed: {
          //有找到關鍵文字
          filter_a: function () {
            return this.a.filter((p) => {
              if (p.title.indexOf(this.filter) != -1) {
                return true;
              }
              return false;
            });
          },
        },
        data: {
          remeber: "",
          //倉庫有值先取無值帶空陣列
          carBook: JSON.parse(window.localStorage.getItem("carBook")) || [],
          buttonSize: "large",
          //倉庫有值先取無值帶空陣列
          login:
            (localStorage.getItem("user") ? "登出" : "會員登入") || "會員登入",
          count: "",
          name: "",
          //倉庫有值先取無值帶空陣列 判斷是否登入
          isAppear: localStorage.getItem("user")
            ? true
            : false || this.local
            ? true
            : false,
          value2: 0,
          formValidate: {
            name: "",
            mail: "",
            city: "",
            gender: "",
            phone: "",
            date: "",
            time: "",
            desc: "",
          },
          ruleValidate: {
            name: [
              { required: true, message: "名字不能空白", trigger: "blur" },
            ],
            mail: [
              { required: true, message: "帳號不能空白", trigger: "blur" },
              { type: "email", message: "帳號不能空白", trigger: "blur" },
            ],
            city: [
              { required: true, message: "請輸入地址", trigger: "change" },
              { required: true, message: "地址不能空白", trigger: "blur" },
            ],
            gender: [
              { required: true, message: "請輸入性別", trigger: "change" },
            ],
            phone: [
              { required: true, message: "電話不能空白", trigger: "blur" },
            ],
            mom: 0,
            date: [],
            desc: [
              {
                type: "string",
                min: 20,
                message: "請輸入二十字以上敘述",
                trigger: "blur",
              },
            ],
          },
          //記憶登入者
          local: localStorage.getItem("user"),
          total: data.length,
          page: 1,
          pageSize: pageSize,
          list: getPagelist(1, pageSize), //頁籤起始
          columns: [
            {
              title: "",
              key: "id",
              width: 60,
            },

            {
              title: "公告",
              key: "name",
            },

            {
              title: "發布者",
              key: "member",
            },
          ],
          //記憶目前頁面位置
          lis: localStorage.getItem("lis")
            ? JSON.parse(localStorage.getItem("lis"))
            : [0, 0, 0, 0],
          filter: "",
          title: [
            "西班牙歷史",
            "魔界",
            "風起雲湧",
            "丹麥女孩",
            "東周列國志",
            "健康身心",
            "情緒說服",
            "真相的凋零",
            "多益",
          ],
          url: [
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/081/38/0010813873.jpg&w=374&h=374&v=5c5411ac",
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/089/66/0010896687.jpg&w=374&h=374&v=60deeab0",
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/058/61/0010586158.jpg&w=374&h=374&v=518a3753",
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/067/62/0010676232.jpg&w=374&h=374&v=555b2ccd",
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/CN1/171/07/CN11710792.jpg&w=374&h=374&v=5df313d0",
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/089/82/0010898234.jpg&v=60f55431&w=280&h=280",
            "https://im2.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/078/58/0010785843.jpg&v=5b078e8d&w=120&h=120",
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/084/98/0010849832.jpg&v=5e5742fa&w=120&h=120",
            "https://im1.book.com.tw/image/getImage?i=https://www.books.com.tw/img/001/089/89/0010898932.jpg&v=6103e2ba&w=150&h=150",
          ],

          a: [],
          b: [1, 2, 3],
        },
        watch: {
          carBook: {
            deep: true, //深層觀察
            handler(val) {
              //一旦數值改變則用字串方式存入儲存庫
              window.localStorage.setItem("carBook", JSON.stringify(val));
            },
          },
        },
        methods: {
          //將所有勾選框勾選
          selectAll() {
            this.carBook.forEach((value, i, arr) => {
              arr[i].checked = true;
            });
          },
          //將所有勾選的刪除
          deleteAll() {
            // var number = 0;
            // var init;
            // var index;
            var arr;
            //選出第一個刪除值
            arr = this.carBook.filter(
              (value, i, arr) => value.checked == false
            );
            console.log(arr);
            // init = this.carBook.find((value) => {
            //   return value.checked == true;
            // });

            // //算出刪除數量
            // this.carBook.forEach((value, i, arr) => {
            //   if (value.checked == true) {
            //     number++;
            //   }
            // });

            // //選出第一個刪除索引
            // this.carBook.forEach((value, i, arr) => {
            //   if (value == init) {
            //     index = i;
            //   }
            // });

            //執行刪除
            this.carBook = arr;
          },
          //將書本加入購物車
          addCar(index) {
            var exitist;

            for (let i = 0; i < this.carBook.length; i++) {
              if (this.filter_a[index].title == this.carBook[i].title) {
                exitist = true;
                //增加書本數量
                this.carBook[i].click = this.carBook[i].click + 1;
              } else {
                //繼續過濾
                continue;
              }
            }
            if (!exitist) {
              //如果不存在push放入新陣列
              this.carBook.push(this.filter_a[index]);
              this.carBook[this.carBook.length - 1].click = 1;
            } else {
              //如果存在則離開
              return;
            }
          },
          clear() {
            //將輸入內容清空
            this.count = "";
            this.name = "";
          },
          dropOut() {
            //登出
            if (this.isAppear == true) {
              this.isAppear = false;
              localStorage.removeItem("name");
              localStorage.removeItem("user");
              this.login = "會員登入";
              if (this.remeber == 1) {
                this.add1();
                window.location.reload();
              } else if (this.remeber == 2) {
                this.add2();
                window.location.reload();
              } else if (this.remeber == 3) {
                this.add3();
                window.location.reload();
              } else {
                this.add3();
                window.location.reload();
              }
            }
          },
          send() {
            //送出登入者內容
            if (this.count && this.name) {
              localStorage.setItem("name", JSON.stringify(this.name));
              localStorage.setItem("user", JSON.stringify(this.count));
              this.isAppear = !this.isAppear;
              this.login = "登出";
              window.location.reload();
            }
          },
          remove() {
            //改變樣式升降 判斷登入與否
            this.isAppear = !this.isAppear;
          },
          handleSubmit(name) {
            //判斷表單是否成功
            this.$refs[name].validate((valid) => {
              if (valid) {
                this.$Message.success("註冊成功");
                localStorage.setItem(
                  "name",
                  JSON.stringify(this.formValidate.name)
                );
                localStorage.setItem(
                  "user",
                  JSON.stringify(this.formValidate.mail)
                );
                setTimeout(() => {
                  //重置表單 元件內置
                  this.$refs[name].resetFields();
                }, 2000);
                window.location.reload();
              } else {
                this.$Message.error("失敗");
              }
            });
          },
          handleReset(name) {
            //重置表單 元件內置
            this.$refs[name].resetFields();
          },
          changePage(p) {
            //改變頁面
            console.log("tag", p);
            this.page = p;
            this.list = getPagelist(p, pageSize); //頁籤設定
          },
          //以下皆為改變頁面顯示與否
          add1(e) {
            this.lis.splice(0, 3, 0, 0, 0, 0); //全部刪除
            this.lis.splice(0, 1, 1); //再添加數值到陣列顯示
            localStorage.setItem("lis", JSON.stringify(this.lis));
            this.remeber = e;
          },
          add2(e) {
            this.lis.splice(0, 3, 0, 0, 0, 0);
            this.lis.splice(1, 1, 1);
            localStorage.setItem("lis", JSON.stringify(this.lis));
            this.remeber = e;
          },
          add3(e) {
            this.lis.splice(0, 3, 0, 0, 0, 0);
            this.lis.splice(2, 1, 1);
            localStorage.setItem("lis", JSON.stringify(this.lis));
            this.remeber = e;
          },

          add4(e) {
            if (!this.local) {
              this.$Modal.warning({
                title: "注意",
                content: "請先登入",
              });
            } else {
              this.lis.splice(0, 3, 0, 0, 0, 0);
              this.lis.splice(3, 1, 1);
              localStorage.setItem("lis", JSON.stringify(this.lis));
            }
          },
        },
      });
    </script>
  </body>
</html>
